# 社群想法貢獻數量變化圖表可行性評估報告

## 📊 評估總覽

**整體成功率：85%**

---

## 1. 功能需求分析

### 核心功能
根據圖片描述，需要實現：

1. **時間序列折線圖**
   - X軸：日期（每天為單位）
   - Y軸：想法建立數量
   - 多條線：每個社群成員一條線

2. **資料統計**
   - 以每天為單位計算每個使用者的想法建立數量
   - 需要顯示所有社群成員的變化趨勢

3. **圖表特性**
   - 可以選擇折線圖或堆疊面積圖
   - 需要圖例顯示不同使用者
   - 可能需要標記當前日期（紅色垂直線）

---

## 2. 資料結構分析

### ✅ 現有資料完整性：**95%**

#### 可用的資料表：
1. **`ideas` 表**
   - ✅ `created_at`：建立時間（TIMESTAMP）
   - ✅ `creator_id`：建立者ID
   - ✅ `community_id`：社群ID
   - ✅ 可以按日期和使用者分組統計

2. **`users` 表**
   - ✅ `id`：使用者ID
   - ✅ `nickname`：使用者暱稱（用於顯示）

### 資料統計邏輯：

#### 按日期和使用者統計想法建立數量
```sql
SELECT 
  DATE(created_at) AS date,
  creator_id AS userId,
  COUNT(*) AS createdCount
FROM ideas
WHERE community_id = ? AND parent_id IS NULL  -- 只統計新增想法，不包含回覆
GROUP BY DATE(created_at), creator_id
ORDER BY date ASC, userId ASC
```
✅ **完全可行**

---

## 3. 技術實現方案

### 3.1 後端 API

**需要建立的 API：`/api/communities/[communityId]/idea-trend`**

#### 技術難度：**中低**
- 需要按日期和使用者分組統計
- 需要處理日期範圍（從最早的想法日期到今天或最近一段時間）
- 需要補零（對於沒有想法的日期）

#### 實現方案：

**方案 A：只返回有資料的日期（簡單）**
- 只返回實際有想法建立的日期
- 前端負責補零和日期範圍處理
- 風險：低

**方案 B：返回完整日期範圍（推薦）**
- 後端計算日期範圍（例如最近30天或從最早想法到今天）
- 後端補零（沒有想法的日期設為0）
- 前端直接使用
- 風險：低

#### 返回資料結構：
```typescript
{
  dateRange: {
    startDate: string,  // 起始日期
    endDate: string     // 結束日期
  },
  userStats: [
    {
      userId: string,
      userName: string,
      dailyCounts: [
        {
          date: string,      // 日期 (YYYY-MM-DD)
          count: number      // 該日期的建立數量
        }
      ]
    }
  ],
  communityId: string
}
```

### 3.2 前端視覺化

**圖表庫：recharts（已安裝）** ✅

#### 需要的組件：
- `LineChart` 或 `AreaChart`（recharts 已支持）
- `Line` 或 `Area` 組件
- `XAxis`（日期）
- `YAxis`（數量）
- `Tooltip`（提示框）
- `Legend`（圖例）

#### 技術難度：**中**
- recharts 已經支持時間序列圖表
- 需要處理多條線的顯示
- 需要處理日期格式化
- 風險：中低

---

## 4. 成功率評估

### 整體成功率：**85%**

### 各階段成功率：

| 階段 | 功能 | 成功率 | 風險 | 時間 |
|------|------|--------|------|------|
| 1 | 資料統計 API | 90% | 低 | 2-3小時 |
| 2 | 折線圖基本顯示 | 90% | 低 | 3-4小時 |
| 3 | 日期處理和補零 | 85% | 中 | 2小時 |
| 4 | 樣式優化和當前日期標記 | 90% | 低 | 1-2小時 |

### 主要挑戰：

1. **日期範圍處理**（中低風險）
   - 需要決定顯示多長時間的資料（最近30天？從最早想法開始？）
   - 需要處理沒有想法的日期（補零）

2. **多條線的顯示**（低風險）
   - recharts 支持多條線，但需要確保顏色不同
   - 如果使用者很多，線可能會重疊

3. **效能考量**（低風險）
   - 如果日期範圍很長（例如一年），資料量可能較大
   - 需要適當限制日期範圍

---

## 5. 實現步驟建議

### 階段 1：資料統計 API（優先）

1. 建立 API：`/api/communities/[communityId]/idea-trend`
2. 實現按日期和使用者統計想法建立數量
3. 實現日期範圍計算（例如最近30天或從最早想法開始）
4. 實現補零邏輯（沒有想法的日期設為0）
5. 測試 API 返回資料

**成功率：90%**
**時間：2-3 小時**

### 階段 2：折線圖基本顯示

1. 建立組件：`IdeaTrendChart.tsx`
2. 使用 recharts 的 `LineChart` 顯示折線圖
3. 實現多條線（每個使用者一條）
4. 實現日期 X 軸和數量 Y 軸
5. 實現圖例顯示

**成功率：90%**
**時間：3-4 小時**

### 階段 3：日期處理和優化

1. 實現日期格式化（顯示為 "6/9" 或 "June 9" 等格式）
2. 實現日期範圍選擇（可選）
3. 實現補零邏輯（確保所有日期都有資料）
4. 實現當前日期標記（紅色垂直線，可選）

**成功率：85%**
**時間：2 小時**

### 階段 4：樣式優化和測試

1. 調整線的顏色和樣式
2. 調整圖表大小和布局
3. 實現 Tooltip 顯示詳細資訊
4. 測試各種情況（空資料、單一使用者、多使用者等）

**成功率：90%**
**時間：1-2 小時**

---

## 6. 風險評估

### 低風險：
- ✅ 資料統計 API（SQL 查詢相對簡單）
- ✅ 折線圖基本顯示（recharts 已支持）
- ✅ 樣式優化（前端調整）

### 中風險：
- ⚠️ 日期範圍處理（需要決定顯示多長時間）
- ⚠️ 補零邏輯（確保所有日期都有資料）

### 高風險：
- ❌ 無明顯高風險項目

---

## 7. 回滾方案

### 如果系統無法啟動：

1. **移除新創建的文件**
   - `app/api/communities/[communityId]/idea-trend/route.ts`
   - `app/components/IdeaTrendChart.tsx`

2. **恢復 CommunityDetail.tsx**
   - 將活動歷程中的趨勢圖部分恢復為「功能開發中」提示

3. **重新啟動系統**

### 回滾難度：**低**
- 新增的文件獨立，不影響現有功能
- 可以快速移除

---

## 8. 推薦的實現策略

### 建議分階段實施：

**階段 1：實現資料統計 API**
- 驗證資料統計邏輯正確性
- 低風險，高成功率（90%）

**階段 2：實現基本折線圖**
- 先顯示簡單的折線圖
- 驗證圖表庫的可用性
- 低風險，高成功率（90%）

**階段 3：日期處理和優化**
- 實現日期範圍和補零
- 實現當前日期標記
- 中風險，中高成功率（85%）

**階段 4：樣式優化和測試**
- 調整樣式和布局
- 完整測試
- 低風險，高成功率（90%）

---

## 9. 結論

### 可行性：**非常可行（85% 成功率）**

### 優勢：
- ✅ 資料結構完整，有 `created_at` 時間戳
- ✅ 現有 API 基礎良好（已有類似的統計 API）
- ✅ 圖表庫已安裝（recharts 支持時間序列圖表）
- ✅ 實現相對簡單，主要是統計和顯示

### 挑戰：
- ⚠️ 日期範圍處理需要決定顯示多長時間
- ⚠️ 補零邏輯需要確保所有日期都有資料
- ⚠️ 如果使用者很多，線可能會重疊

### 建議：
- ✅ **強烈建議實施**
- ✅ 分階段進行，降低風險
- ✅ 先實現資料統計 API，驗證可行性
- ✅ 使用 recharts 的 `LineChart` 或 `AreaChart`

---

## 10. 需要的依賴

### 已安裝：
- ✅ `recharts`（已安裝，支持 LineChart 和 AreaChart）

### 不需要額外安裝：
- 所有需要的圖表組件都在 recharts 中

---

## 📝 備註

- 所有更改都會確保系統穩定性
- 提供完整的回滾方案
- 分階段實施，降低風險
- 每階段完成後測試系統穩定性
- 優先實現資料統計 API，驗證資料準確性

### 與現有功能的關係：

- ✅ 可以復用現有的 `idea-stats` API 邏輯
- ✅ 可以參考 `IdeaContributionChart` 組件的實現方式
- ✅ 使用相同的圖表庫（recharts）

### 日期範圍建議：

- **選項 1：最近 30 天**（推薦）
  - 顯示最近 30 天的資料
  - 簡單直接，資料量可控

- **選項 2：從最早想法開始**
  - 顯示所有歷史資料
  - 需要處理較長的日期範圍

- **選項 3：自定義日期範圍**（進階）
  - 允許使用者選擇日期範圍
  - 需要額外的 UI 組件

### 統計邏輯：

- **只統計新增想法**（`parent_id IS NULL`）
  - 符合圖片描述（只統計建立數量，不包括回覆）

- **每天統計**
  - 使用 `DATE(created_at)` 按日期分組
  - 統計每天每個使用者建立的想法數量

---

## 11. 實現示例

### API 返回資料示例：
```json
{
  "dateRange": {
    "startDate": "2024-06-01",
    "endDate": "2024-06-30"
  },
  "userStats": [
    {
      "userId": "user-1",
      "userName": "王小名",
      "dailyCounts": [
        { "date": "2024-06-09", "count": 1 },
        { "date": "2024-06-10", "count": 5 },
        { "date": "2024-06-11", "count": 3 },
        { "date": "2024-06-12", "count": 0 },
        { "date": "2024-06-13", "count": 2 }
      ]
    },
    {
      "userId": "user-2",
      "userName": "使用者B",
      "dailyCounts": [
        { "date": "2024-06-09", "count": 0 },
        { "date": "2024-06-10", "count": 1 },
        { "date": "2024-06-11", "count": 2 }
      ]
    }
  ],
  "communityId": "community-1"
}
```

---

## 12. 與其他圖表的關係

這個功能是活動歷程頁面中三個圖表之一：

1. ✅ **社群想法貢獻數量圖**（已完成）
   - 橫向條狀圖，顯示總計

2. ⏳ **社群網絡圖**（計劃中）
   - 網絡圖，顯示成員互動關係

3. ⏳ **社群想法貢獻數量變化圖表**（本評估）
   - 時間序列折線圖，顯示變化趨勢

三個圖表互補，從不同角度展示社群的想法貢獻情況。

