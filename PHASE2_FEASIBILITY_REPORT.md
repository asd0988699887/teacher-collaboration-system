# 第二階段可行性評估報告：檢視和修改功能

## 📊 評估總覽

**整體成功率：75%** （修改功能較高，檢視功能需要新增機制）

---

## 1. 修改功能評估

### ✅ 成功率：**85%**

### 現有基礎：
- ✅ `ideas` 表已有 `updated_at` 欄位
- ✅ `updated_at` 設有 `ON UPDATE CURRENT_TIMESTAMP`（自動更新）
- ✅ 修改 API 已存在：`PUT /api/ideas/[ideaId]`
- ✅ 當使用者儲存想法時，`updated_at` 會自動更新

### 實現方案：

**方案 A：統計被修改過的想法數量（推薦）**
- 邏輯：統計 `updated_at > created_at` 的想法（表示至少被修改過一次）
- 優點：
  - ✅ 實現簡單，只需修改 SQL 查詢
  - ✅ 不需要修改現有 API
  - ✅ 不影響現有功能
- 缺點：
  - ❌ 只能統計「是否修改過」，無法統計「修改次數」
  - ❌ 如果一個想法被修改多次，只能計為 1 次

**方案 B：新增修改歷史表（完整方案）**
- 需要建立新資料表：`idea_modifications`
- 在每次修改時記錄修改歷史
- 優點：
  - ✅ 可以準確統計修改次數
  - ✅ 可以追蹤修改歷史
- 缺點：
  - ⚠️ 需要修改現有 API（`PUT /api/ideas/[ideaId]`）
  - ⚠️ 需要新增資料表
  - ⚠️ 風險較高（需要修改現有功能）

### 技術難度：**中低**

### 風險評估：**低**
- 方案 A：只讀查詢，不影響現有功能
- 方案 B：需要修改現有 API，有風險

---

## 2. 檢視功能評估

### ⚠️ 成功率：**65%**

### 現有基礎：
- ❌ **沒有檢視追蹤機制**
- ✅ 想法卡片有點擊事件（`handleEditIdea`）
- ✅ 點擊會打開 `EditIdeaModal`（模態框）

### 實現方案：

**需要新增完整檢視追蹤機制**

1. **資料表設計**：
   ```sql
   CREATE TABLE idea_views (
     id VARCHAR(36) PRIMARY KEY,
     idea_id VARCHAR(36) NOT NULL,
     user_id VARCHAR(36) NOT NULL,
     viewed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
     FOREIGN KEY (idea_id) REFERENCES ideas(id) ON DELETE CASCADE,
     FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
     INDEX idx_idea_user (idea_id, user_id),
     INDEX idx_viewed_at (viewed_at)
   );
   ```

2. **需要修改的地方**：
   - ✅ 新增資料表（低風險）
   - ⚠️ 新增檢視 API：`POST /api/ideas/[ideaId]/view`
   - ⚠️ 修改前端：在打開模態框時記錄檢視
   - ⚠️ 需要決定：是否要過濾重複檢視（同一個使用者看同一個想法多次）

3. **檢視統計邏輯**：
   - **選項 A：統計每個使用者檢視的想法數量**
     - 邏輯：`COUNT(DISTINCT idea_id) WHERE user_id = ?`
     - 優點：簡單直接
     - 缺點：如果同一個使用者看同一個想法多次，只計 1 次
   
   - **選項 B：統計每個使用者的總檢視次數**
     - 邏輯：`COUNT(*) WHERE user_id = ?`
     - 優點：更準確反映使用者的活躍度
     - 缺點：需要決定是否要去重（同一個想法看多次是否都計入）

### 技術難度：**中**

### 風險評估：**中**
- ✅ 新增資料表（低風險）
- ⚠️ 修改前端邏輯（中風險）
- ⚠️ 需要考慮效能（如果有很多檢視記錄）

---

## 3. 綜合評估

### 實現優先級：

1. **第一優先：修改功能（方案 A）**
   - 成功率：85%
   - 風險：低
   - 實現時間：1-2 小時
   - 只需要修改 SQL 查詢，不影響現有功能

2. **第二優先：檢視功能**
   - 成功率：65%
   - 風險：中
   - 實現時間：3-4 小時
   - 需要新增資料表和修改前端邏輯

### 建議實施策略：

**階段 2.1：先實現修改功能（方案 A）**
- 風險低，成功率 high
- 可以快速看到效果
- 驗證系統穩定性

**階段 2.2：再實現檢視功能**
- 在前一階段驗證系統穩定後
- 分步驟實施：
  1. 新增資料表
  2. 新增檢視 API
  3. 修改前端邏輯
  4. 測試和優化

---

## 4. 風險與挑戰

### 修改功能：
- ✅ **低風險**：方案 A 只讀查詢，不影響現有功能
- ⚠️ **中風險**：方案 B 需要修改現有 API

### 檢視功能：
- ⚠️ **效能考量**：如果檢視記錄很多，查詢可能變慢
- ⚠️ **去重邏輯**：需要決定是否要過濾重複檢視
- ⚠️ **前端整合**：需要在正確的時機記錄檢視（打開模態框時）

---

## 5. 回滾方案

### 修改功能（方案 A）：
- ✅ **容易回滾**：只修改 SQL 查詢，可以快速恢復
- ✅ **不影響資料**：只讀查詢，不會改變資料

### 檢視功能：
- ⚠️ **中等回滾難度**：需要刪除資料表和 API，移除前端邏輯
- ✅ **不影響現有資料**：新增的資料表獨立，不影響現有功能

---

## 6. 結論

### 建議：

1. **先實現修改功能（方案 A）**
   - 成功率：85%
   - 風險：低
   - 可以快速驗證系統穩定性

2. **再實現檢視功能**
   - 成功率：65%
   - 風險：中
   - 需要更多測試和優化

3. **如果修改功能成功，再考慮修改功能的方案 B**
   - 如果需要更準確的修改次數統計
   - 可以作為第三階段實施

### 預期結果：

- **修改功能**：可以顯示每個使用者「修改過的想法數量」（至少修改過一次）
- **檢視功能**：可以顯示每個使用者「檢視過的想法數量」或「總檢視次數」

---

## 7. 建議的顏色配置

根據用戶需求：
- 🟦 **淺藍色**：新增
- 🟩 **青色/藍綠色**：回覆
- 🟨 **黃色**：修改（新增）
- 🩷 **粉色**：檢視（新增）

---

## 📝 備註

- 所有更改都會確保系統穩定性
- 提供完整的回滾方案
- 分階段實施，降低風險
- 每階段完成後測試系統穩定性

