# 社群網絡圖節點大小調整

## 修改日期
2026-01-04

## 問題描述
用戶反映社群網絡圖中的圓球大小差異不夠明顯：
- 橘色圓球（排名較高）比藍色圓球（排名較低）只大一點點
- 希望增強視覺差異，讓排名高的圓球更大更醒目

## 修改內容

### 修改文件
`app/components/NetworkGraph.tsx`

### 修改位置
1. **第 211 行** - `calculateNodeRadius` 函數
2. **第 254 行** - `nodeCanvasObject` 函數

### 修改細節

#### 修改前
```typescript
// 每高一個名次，半徑增加 1（直徑增加 2）
const radiusIncrement = 1
```

#### 修改後
```typescript
// 每高一個名次，半徑增加 1.5（直徑增加 3）- 增強排名差異視覺效果
const radiusIncrement = 1.5
```

## 效果說明

### 計算邏輯
- **基礎半徑**：根據文字內容計算，所有節點相同（確保文字能完整顯示）
- **排名獎勵**：`(總節點數 - 當前排名) × radiusIncrement`

### 視覺效果對比

假設有 3 個節點：

| 排名 | 修改前半徑增加 | 修改前直徑增加 | 修改後半徑增加 | 修改後直徑增加 | 增強比例 |
|------|--------------|--------------|--------------|--------------|---------|
| 第 1 名 | +2 | +4 | +3 | +6 | **1.5x** |
| 第 2 名 | +1 | +2 | +1.5 | +3 | **1.5x** |
| 第 3 名 | 0（基準） | 0（基準） | 0（基準） | 0（基準） | - |

### 具體範例（假設基礎半徑 = 10）

| 排名 | 修改前半徑 | 修改前直徑 | 修改後半徑 | 修改後直徑 | 面積增加 |
|------|----------|----------|----------|----------|---------|
| 第 1 名 | 12 | 24 | 13 | 26 | +21.7% |
| 第 2 名 | 11 | 22 | 11.5 | 23 | +8.2% |
| 第 3 名 | 10 | 20 | 10 | 20 | 基準 |

### 視覺改善
- ✅ **排名第一的節點（橘色）**：更加醒目，視覺層級明確
- ✅ **排名最後的節點（藍色）**：保持原有大小不變
- ✅ **中間排名的節點**：按比例放大，形成清晰的視覺梯度

## 技術細節

### 為什麼選擇 1.5 倍？
1. **視覺識別度**：1.5 倍是人眼能明顯感知差異的比例
2. **不失平衡**：不會讓高排名節點過大而影響整體布局
3. **符合用戶需求**：正好是用戶要求的「從 x 到 1.5x」

### 節點大小計算公式
```
最終半徑 = 基礎半徑 + (總節點數 - 當前排名) × 1.5

其中：
- 基礎半徑：根據文字內容動態計算，確保文字可見
- 總節點數：社群中的用戶總數
- 當前排名：根據活動度（建立+回覆+被回覆）排序，1 = 第一名
```

## 影響範圍

### 受影響的功能
- ✅ 社群網絡圖的節點顯示
- ✅ 節點的視覺層級

### 不受影響的功能
- ✅ 節點連線關係
- ✅ 節點拖拽交互
- ✅ 節點點擊詳情
- ✅ 統計數據計算
- ✅ 其他圖表（貢獻度圖、趨勢圖）

## 回滾方案

### 快速回滾
```bash
# 恢復到修改前的版本
Copy-Item app\components\NetworkGraph.tsx.backup_node_size app\components\NetworkGraph.tsx -Force
```

### 手動回滾
將 `radiusIncrement` 的值從 `1.5` 改回 `1`：

```typescript
// 找到這兩處（第 211 行和第 254 行）
const radiusIncrement = 1.5  // 改回 1
```

## 驗證步驟

### 測試步驟
1. 刷新瀏覽器頁面
2. 進入任意社群的「活動歷程」標籤
3. 切換到「社群網絡圖」視圖
4. 觀察節點大小差異

### 預期結果
- ✅ 排名第一的節點明顯比其他節點大
- ✅ 節點大小呈現清晰的梯度變化
- ✅ 最後一名的節點保持原有大小
- ✅ 文字仍然清晰可讀

### 視覺檢查清單
- [ ] 第一名的節點（橘色）比之前更大
- [ ] 最後一名的節點（藍色）大小不變
- [ ] 節點之間的大小差異更加明顯
- [ ] 節點文字沒有被截斷
- [ ] 整體布局仍然平衡

## 備註

### 備份文件
- **位置**：`app/components/NetworkGraph.tsx.backup_node_size`
- **內容**：修改前的原始文件

### 未來調整建議
如果需要進一步調整：
- 想要差異更大：增加 `radiusIncrement`（例如：2.0）
- 想要差異更小：減少 `radiusIncrement`（例如：1.2）
- 想要非線性增長：可改用指數函數

### 相關公式
```typescript
// 線性增長（當前使用）
rankBonus = (totalNodes - rank) × 1.5

// 如果想要指數增長（可選）
rankBonus = Math.pow(totalNodes - rank + 1, 1.2) 

// 如果想要對數增長（可選）
rankBonus = Math.log(totalNodes - rank + 2) × 3
```

## 總結

✅ **修改完成**
- 節點大小差異從原本的 `1x` 增加到 `1.5x`
- 視覺層級更加明確
- 符合用戶需求

✅ **安全性**
- 已創建備份文件
- 修改範圍小（只改 2 處數值）
- 不影響其他功能

✅ **可回滾性**
- 提供快速回滾命令
- 提供手動回滾指引

